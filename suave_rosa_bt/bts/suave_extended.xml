<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RetryUntilSuccessful num_attempts="-1">
      <SequenceWithMemory>
        <SequenceWithMemory>
          <ArmThrusters/>
          <SetGuidedMode/>
        </SequenceWithMemory>
        <ReactiveSequence>
          <Fallback>
            <SequenceWithMemory>
              <Fallback>
                <IsPipelineFound/>
                <ReactiveSequence>
                  <IsActionFeasible action_name="search_pipeline"/>
                  <search_pipeline/>
                </ReactiveSequence>
              </Fallback>
              <Fallback>
                <IsPipelineInspected/>
                <ReactiveSequence>
                  <IsActionFeasible action_name="inspect_pipeline"/>
                  <inspect_pipeline/>
                </ReactiveSequence>
              </Fallback>
            </SequenceWithMemory>
            <ReactiveSequence>
              <IsActionFeasible action_name="recharge"/>
              <recharge/>
            </ReactiveSequence>
          </Fallback>
          <ReactiveSequence>
            <IsPipelineFound/>
            <IsPipelineInspected/>
          </ReactiveSequence>
        </ReactiveSequence>
      </SequenceWithMemory>
    </RetryUntilSuccessful>
  </BehaviorTree>

  <BehaviorTree ID="inspect_tree">
    <ReactiveSequence>
      <IsActionFeasible action_name="inspect_pipeline"/>
      <inspect_pipeline/>
    </ReactiveSequence>
  </BehaviorTree>

  <BehaviorTree ID="recharge_tree">
    <ReactiveSequence>
      <IsActionFeasible action_name="recharge"/>
      <recharge/>
    </ReactiveSequence>
  </BehaviorTree>

  <BehaviorTree ID="search_tree">
    <ReactiveSequence>
      <IsActionFeasible action_name="search_pipeline"/>
      <search_pipeline/>
    </ReactiveSequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="ArmThrusters"
            editable="true"/>
    <Condition ID="IsActionFeasible"
               editable="true">
      <input_port name="action_name"/>
    </Condition>
    <Condition ID="IsPipelineFound"/>
    <Condition ID="IsPipelineInspected"/>
    <Action ID="SetGuidedMode"
            editable="true"/>
    <Action ID="inspect_pipeline"/>
    <Action ID="recharge"/>
    <Action ID="search_pipeline"/>
  </TreeNodesModel>

</root>
